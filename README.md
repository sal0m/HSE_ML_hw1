# Car Price Prediction Service

## Описание
Этот проект представляет собой FastAPI-сервис, который выполняет предсказания стоимости автомобилей на основе предоставленных данных.

## Функциональность
1. Прогноз стоимости по одному автомобилю  
   Отправьте JSON с характеристиками одного автомобиля, чтобы получить предсказанную стоимость.
2. Прогноз стоимости для нескольких автомобилей из CSV-файла  
   Загрузите CSV-файл с характеристиками автомобилей, чтобы получить файл с предсказаниями.

## Установка
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/sal0m/HSE_ML_hw1.git
   cd HSE_ML_hw1
2. Установите зависимости:
   ```bash
    pip install -r requirements.txt

## Запуск
   ```bash
   uvicorn car_price_api:app --reload
```

## Использование
1.  Прогноз по одному объекту
- эндпоинт POST /predict_item

Пример использования:
![src/imgs/predict_item.jpg](src/imgs/predict_item.jpg)

2.  Прогноз по нескольким объектам в csv файле 
- эндпоинт POST /predict_items

Пример использования:
![src/imgs/predict_items_csv.jpg](src/imgs/predict_items_csv.jpg)

Пример ответа:
![src/imgs/predictions.jpg](src/imgs/predictions.jpg)

## Тестирование

Для тестирования ендпоинтов можно использовать Swagger UI, доступный по адресу:

**http://127.0.0.1:8000/docs**


![src/imgs/endpoints.jpg](src/imgs/endpoints.jpg)

# Отчет по выполненной работе

## Часть 1 | EDA

### Что было сделано:

1. Базовый EDA и обработка признаков:
   - Обнаружены пропуски в колонках: mileage, engine, max_power, torque, seats.
   - Найдены и удалены явные дубликаты (≈1.2% от датасета).
   - Построен дашборд с помощью ydata-profiling для детального анализа признаков.

2. Анализ статистик:
   - Проведен анализ основных статистик по числовым и категориальным признакам.
   - Средние и медианные значения между train и test близки, что указывает на сходство распределений.

3. Обработка признаков:
   - Признаки mileage, engine, max_power приведены к числовому виду.
   - Признак torque разделен на два: собственно torque и max_torque_rpm.
   - Пропуски заполнены медианами из тренировочного датасета.

4. Визуализация данных:
   - Построены pairplot для числовых признаков в train и test.
   - Обнаружены значимые связи между признаками:
     - Сильная отрицательная корреляция: km_driven и year.
     - Положительная корреляция: selling_price и year, selling_price и max_power.

5. Корреляционный анализ:
   - Реализована корреляции Спирмена
   - Построена матрица корреляции Phik для учета нелинейных зависимостей

### Результаты:
- Удаление дубликатов и обработка пропусков улучшили качество данных.
- Обнаружены значимые связи между признаками и целевой переменной.
- Распределения train и test согласуются, что является хорошим знаком.

---

## Часть 2 | Модель только на вещественных признаках

### Что было сделано:

1. Разделение данных:
   - Данные разделены на train и test для валидации. Использованы только вещественные признаки.

2. Базовая линейная регрессия:
   - Обучена линейная регрессия с дефолтными параметрами.
   - Посчитаны $R^2$ и $MSE$

4. Стандартизация данных:
   - Проведена стандартизация числовых признаков. Обучение стандартизатора выполнено на train.

5. Интерпретация признаков:
   - Наиболее важным признаком оказался max_power.

6. Lasso-регрессия:
   - Обучена Lasso-регрессия на стандартизированных данных.
   - Проверено зануление коэффициентов — один признак занулился (torque)

7. Кросс-валидация и ElasticNet:
   - Проведен перебор параметров для Lasso-регрессии с помощью GridSearchCV.
   - Построена модель ElasticNet для повышения устойчивости.

### Результаты:
- Базовая линейная регрессия показала хорошие результаты, но Lasso-регрессия уменьшила переобучение и занулила незначимый признаки.
- GridSearchCV позволил найти оптимальные параметры регуляризации, что увеличило $R^2$ на валидационной выборке до 0.56.

### Часть 3 | Работа с категориальными признаками

#### Кодирование категориальных признаков  

1. One-Hot Encoding:  
   - Закодированы все категориальные признаки (`fuel`, seller_type, transmission, `owner`) 
   - Недостатки: увеличение размерности данных.  

#### Добавление категориальных признаков в модель 
1. Линейная регрессия с категориальными признаками:  
   - Вывод: учёт категориальных признаков улучшил качество модели.  

2. Lasso-регрессия с категориальными признаками 

---

### Часть 4 | Генерация новых признаков

#### Задание 21. Вычисленные признаки (0.4 балла)  
1. Созданы новые числовые признаки:  
   - power_per_liter 
   - mileage_per_km 
   - year_squared

2. Логарифмирование признаков: 
   - ['km_driven', 'torque', 'max_power'] 

3. Полиномиальные признаки
- Использован PolynomialFeatures (2-й степени) для числовых признаков: 

#### Итоги фиче-генерации  
- Получилось увеличить $R^2$ на валидационной выборке до 0.81, на тестовой - до 0.84




